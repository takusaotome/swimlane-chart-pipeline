# Swimlane Chart Pipeline - Skill/Agent ä½œæˆè¨ˆç”» v2

## æ¦‚è¦

ãŠå®¢æ§˜ãƒ’ã‚¢ãƒªãƒ³ã‚°æƒ…å ±ï¼ˆè­°äº‹éŒ²ãƒ»ãƒ¡ãƒ¢ãƒ»æ¥­å‹™ã‚·ãƒŠãƒªã‚ªï¼‰ã‹ã‚‰ã€Miroä¸Šã®ã‚¹ã‚¤ãƒ ãƒ¬ãƒ¼ãƒ³ãƒãƒ£ãƒ¼ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚Claude Code ã® skill / agent ã¨ã—ã¦å®Ÿè£…ã—ã€`/swimlane-pipeline` ã‚³ãƒãƒ³ãƒ‰ä¸€ã¤ã§å…¨å·¥ç¨‹ã‚’å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹ã€‚

**æƒ³å®šè¦æ¨¡:** ä¸­ã€œå¤§ï¼ˆlane 8-15, column 10-20, node 40-100ï¼‰

---

## ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“åƒ

```mermaid
flowchart TD
    INPUT["ğŸ“„ è­°äº‹éŒ² / ãƒ¡ãƒ¢ / ç®‡æ¡æ›¸ã"]
    S1["Step 1: process-analyzer<br/>æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹åˆ†æ â†’ requirements.md<br/>ä¸æ˜ç‚¹ã¯Askã§è³ªå•ï¼ˆ2ãƒ©ã‚¦ãƒ³ãƒ‰/15å•ï¼‰"]
    UC1{{"â˜… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª<br/>è¦ä»¶å®šç¾©æ›¸ã®æ‰¿èª"}}
    S2["Step 2: requirements-reviewer<br/>+ process-consultant Agent<br/>æŠœã‘æ¼ã‚Œãƒ»çŸ›ç›¾ã‚’æ¤œå‡º"]
    S2CHECK{"Critical/Major<br/>æŒ‡æ‘˜ã‚ã‚Šï¼Ÿ"}
    S2ROUND{"3ãƒ©ã‚¦ãƒ³ãƒ‰<br/>åˆ°é”ï¼Ÿ"}
    S3["Step 3: chart-planner<br/>è¦ä»¶ â†’ chart_plan.json<br/>â˜… ãƒ¬ãƒ¼ãƒ³é †åºæœ€é©åŒ–ãƒ»ã‚«ãƒ©ãƒ çµ±åˆ"]
    S4["Step 4: chart-generator<br/>JSON â†’ Miro APIï¼ˆå°‚ç”¨Frameå†…ï¼‰<br/>éšæ™‚miro_items.json flush"]
    S5["Step 5: chart-layout-reviewer<br/>Miro APIèª­æˆ»ã— + æ¤œè¨¼<br/>JSON Patchå½¢å¼ã§ä¿®æ­£ææ¡ˆ"]
    S5CHECK{"ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ<br/>å•é¡Œã‚ã‚Šï¼Ÿ"}
    S5ROUND{"3ãƒ©ã‚¦ãƒ³ãƒ‰<br/>åˆ°é”ï¼Ÿ"}
    CLEANUP["cleanup â†’ chart_plan.json ãƒ‘ãƒƒãƒé©ç”¨"]
    OUTPUT["ğŸ¯ Miro Board URL"]

    INPUT --> S1
    S1 --> UC1
    UC1 -->|æ‰¿èª| S2
    S2 --> S2CHECK
    S2CHECK -->|No| S3
    S2CHECK -->|Yes| S2ROUND
    S2ROUND -->|No| S2
    S2ROUND -->|Yes| S3
    S3 --> S4
    S4 --> S5
    S5 --> S5CHECK
    S5CHECK -->|No| OUTPUT
    S5CHECK -->|Yes| S5ROUND
    S5ROUND -->|No| CLEANUP
    S5ROUND -->|Yes| OUTPUT
    CLEANUP --> S4
```

### Step 5 ã®è²¬å‹™æ˜ç¢ºåŒ–

Step 5 ã¯**å˜ç‹¬Skillã‚’ä½œã‚‰ãªã„**ã€‚swimlane-pipeline skill å†…ã§ chart-layout-reviewer agent ã‚’å‘¼ã³å‡ºã™å½¢ã¨ã™ã‚‹ã€‚ç†ç”±: Step 5ã¯Step 3-4ã¨ä¸€ä½“ã®ãƒ«ãƒ¼ãƒ—ã§ã‚ã‚Šã€å˜ç‹¬ã§å®Ÿè¡Œã™ã‚‹æ„å‘³ãŒãªã„ãŸã‚ã€‚

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªãƒã‚¤ãƒ³ãƒˆï¼ˆé‡è¦ãƒã‚¤ãƒ³ãƒˆã®ã¿åœæ­¢ï¼‰

| ã‚¿ã‚¤ãƒŸãƒ³ã‚° | æ¡ä»¶ | åœæ­¢ |
|---|---|---|
| Step 1 å®Œäº†å¾Œ | å¸¸ã« | âœ… è¦ä»¶å®šç¾©æ›¸ã®ç¢ºèª |
| Step 2 ä¿®æ­£æ™‚ | Critical/MajoræŒ‡æ‘˜æ™‚ | âœ… å·®åˆ†ãƒ‘ãƒƒãƒã®æ‰¿èª |
| Step 2 ä¿®æ­£æ™‚ | Minor/InfoæŒ‡æ‘˜æ™‚ | âŒ è‡ªå‹•é©ç”¨ |
| Step 3 å®Œäº†å¾Œ | â€” | âŒ è‡ªå‹•é€²è¡Œ |
| Step 4 å®Œäº†å¾Œ | â€” | âŒ è‡ªå‹•é€²è¡Œ |
| Step 5 å•é¡Œæ¤œå‡ºæ™‚ | ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå•é¡Œã‚ã‚Š | âœ… ä¿®æ­£ãƒ‘ãƒƒãƒã®æ‰¿èª |
| å®Œäº†æ™‚ | å¸¸ã« | âœ… æœ€çµ‚URLæç¤º |

---

## ä½œæˆç‰©ä¸€è¦§

### Skills (5ã¤)

| Skillå | ç›®çš„ | Step |
|---|---|---|
| process-analyzer | éæ§‹é€ ãƒ†ã‚­ã‚¹ãƒˆ â†’ æ¥­å‹™è¦ä»¶å®šç¾©æ›¸(markdown) | 1 |
| requirements-reviewer | è¦ä»¶å®šç¾©æ›¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ«ãƒ¼ãƒ—åˆ¶å¾¡ | 2 |
| chart-planner | è¦ä»¶å®šç¾©æ›¸ â†’ ãƒãƒ£ãƒ¼ãƒˆè¨ˆç”»JSON | 3 |
| chart-generator | ãƒãƒ£ãƒ¼ãƒˆè¨ˆç”»JSON â†’ Miroä¸Šã«ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆ | 4 |
| swimlane-pipeline | å…¨ã‚¹ãƒ†ãƒƒãƒ—çµ±åˆ + Step5ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ«ãƒ¼ãƒ— | å…¨ä½“ |

### Agents (3ã¤)

| Agentå | ç›®çš„ | å‘¼å‡ºå…ƒ |
|---|---|---|
| process-consultant | è¦ä»¶å®šç¾©æ›¸ã®æŠœã‘æ¼ã‚Œãƒ»çŸ›ç›¾ãƒ¬ãƒ“ãƒ¥ãƒ¼ | requirements-reviewer skill (Step 2) |
| chart-layout-reviewer | ãƒãƒ£ãƒ¼ãƒˆã®è¦–è¦šå“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼ | swimlane-pipeline skillå†… (Step 5) |
| process-analyst | éæ§‹é€ ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã®ãƒ—ãƒ­ã‚»ã‚¹æŠ½å‡º | process-analyzer skill (Step 1) |

### Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ç›®çš„ |
|---|---|
| src/swimlane_lib.py | æ—¢å­˜swimlane_chart.pyã‹ã‚‰æŠ½å‡ºã—ãŸã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| src/chart_plan_loader.py | chart_plan.jsonèª­ã¿è¾¼ã¿ï¼‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| scripts/generate_chart.py | JSON â†’ Miro ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆï¼ˆå°‚ç”¨Frameå†…ã€éšæ™‚flushï¼‰ |
| scripts/cleanup_chart.py | run_idã‚¹ã‚³ãƒ¼ãƒ—å†…ã®ã‚¢ã‚¤ãƒ†ãƒ ä¸€æ‹¬å‰Šé™¤ |
| scripts/validate_chart.py | run_idã‚¹ã‚³ãƒ¼ãƒ—å†…ã®Miro APIèª­æˆ»ã—ï¼‹ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯æ¤œè¨¼ |

---

## å®‰å…¨è¨­è¨ˆ: run_id ã¨ã‚¹ã‚³ãƒ¼ãƒ—ç®¡ç†

### run_id ã®å°å…¥

å…¨ã¦ã®ç”Ÿæˆç‰©ã‚’ run_idï¼ˆUUID v4ï¼‰ã§è¿½è·¡ã™ã‚‹ã€‚

```
output/
â”œâ”€â”€ {run_id}/
â”‚   â”œâ”€â”€ requirements.md
â”‚   â”œâ”€â”€ chart_plan.json
â”‚   â”œâ”€â”€ miro_items.json      â† éšæ™‚flushï¼ˆéƒ¨åˆ†å¤±æ•—æ™‚ã‚‚IDãŒæ®‹ã‚‹ï¼‰
â”‚   â””â”€â”€ validation_report.json
```

### Miroä¸Šã®ã‚¹ã‚³ãƒ¼ãƒ—: å°‚ç”¨Frame

- å„run_idã”ã¨ã«Miroãƒœãƒ¼ãƒ‰ä¸Šã«**å°‚ç”¨Frame**ã‚’ä½œæˆ
- Frameå: `[swimlane] {title} ({run_idçŸ­ç¸®})`
- å…¨ãƒãƒ¼ãƒ‰ãƒ»ã‚³ãƒã‚¯ã‚¿ã¯ã“ã®Frameå†…ã«é…ç½®
- cleanupæ™‚ã¯Frameå†…ã®ã‚¢ã‚¤ãƒ†ãƒ ã®ã¿å‰Šé™¤ï¼ˆä»–ã®ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å½±éŸ¿ã—ãªã„ï¼‰
- readback/validateæ™‚ã‚‚Frameå†…ã®ã‚¢ã‚¤ãƒ†ãƒ ã®ã¿å¯¾è±¡

### miro_items.json ã®éšæ™‚flush

```json
{
  "run_id": "a1b2c3d4-...",
  "board_id": "uXjVGHJn7Xs=",
  "frame_id": "miro_item_xxx",
  "created_at": "2026-02-01T22:00:00+09:00",
  "items": [
    {"key": "START", "miro_id": "abc123", "type": "shape", "batch": 1},
    {"key": "SF_INPUT", "miro_id": "def456", "type": "shape", "batch": 1}
  ],
  "connectors": [
    {"src": "START", "dst": "SF_INPUT", "miro_id": "ghi789"}
  ],
  "status": "in_progress"
}
```

å„ãƒãƒƒãƒé€ä¿¡æˆåŠŸæ™‚ã«å³åº§ã«ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ã€‚éƒ¨åˆ†å¤±æ•—æ™‚ã§ã‚‚ä½œæˆæ¸ˆã¿IDãŒä¿æŒã•ã‚Œã‚‹ã€‚

---

## ä¿®æ­£ã®å®‰å…¨è¨­è¨ˆ: ãƒ‘ãƒƒãƒæ–¹å¼

### Step 2 (è¦ä»¶ãƒ¬ãƒ“ãƒ¥ãƒ¼) ã®ä¿®æ­£ãƒ•ãƒ­ãƒ¼

ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æŒ‡æ‘˜ã•ã‚ŒãŸä¿®æ­£ã¯**å·®åˆ†ãƒ‘ãƒƒãƒã¨ã—ã¦ææ¡ˆ**ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¾Œã«åæ˜ ã™ã‚‹ã€‚

```
process-consultant agent â†’ æŒ‡æ‘˜äº‹é …ãƒªã‚¹ãƒˆ
  â”œâ”€â”€ Critical/Major â†’ å·®åˆ†ãƒ‘ãƒƒãƒç”Ÿæˆ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤º â†’ æ‰¿èªå¾Œã«é©ç”¨
  â””â”€â”€ Minor/Info â†’ è‡ªå‹•é©ç”¨ï¼ˆäº‹å®Ÿã®æ›¸ãæ›ãˆã§ã¯ãªãã€è¨˜è¼‰è¿½åŠ ãƒ»æ˜ç¢ºåŒ–ã®ã¿ï¼‰
```

### Step 5 (ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£) ã®ãƒ‘ãƒƒãƒå½¢å¼

chart_plan.json ã¸ã®ä¿®æ­£ã¯ **JSON Patché¢¨** ã®æ©Ÿæ¢°é©ç”¨å¯èƒ½ãªå½¢å¼ã§è¨˜è¿°ã™ã‚‹ã€‚

```json
{
  "review_round": 1,
  "findings": [
    {
      "severity": "Major",
      "description": "SF_INPUTã¨SLACK_DONEãŒé‡ãªã£ã¦ã„ã‚‹",
      "patch": [
        {"op": "replace", "path": "/nodes/1/dx", "value": 80},
        {"op": "replace", "path": "/layout/col_width", "value": 400}
      ]
    }
  ]
}
```

chart-layout-reviewer agentã¯ã“ã®å½¢å¼ã§å‡ºåŠ›ã—ã€validate_chart.pyãŒãƒ‘ãƒƒãƒã‚’è‡ªå‹•é©ç”¨ã™ã‚‹ã€‚

---

## Step 1 ã®çµ‚äº†æ¡ä»¶

process-analyzer skillã®è³ªå•ãƒ«ãƒ¼ãƒ—ã«æ˜ç¢ºãªæ‰“ã¡åˆ‡ã‚Šæ¡ä»¶ã‚’è¨­ã‘ã‚‹ã€‚

| æ¡ä»¶ | å€¤ | å‡¦ç† |
|---|---|---|
| æœ€å¤§ãƒ©ã‚¦ãƒ³ãƒ‰æ•° | 2ãƒ©ã‚¦ãƒ³ãƒ‰ | æ‰“ã¡åˆ‡ã‚Š |
| æœ€å¤§è³ªå•æ•° | 15å•ï¼ˆç´¯è¨ˆï¼‰ | æ‰“ã¡åˆ‡ã‚Š |
| å…¨ç–‘å•è§£æ¶ˆ | â€” | æ­£å¸¸çµ‚äº† |

**æ‰“ã¡åˆ‡ã‚Šæ™‚ã®å‡¦ç†:** æœªç¢ºèªäº‹é …ã¯è¦ä»¶å®šç¾©æ›¸ã®ã€Œå‰æãƒ»æœªç¢ºèªäº‹é …ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã« `(Assumption)` ã‚¿ã‚°ä»˜ãã§è¨˜éŒ²ã—ã€å¾Œç¶šã‚¹ãƒ†ãƒƒãƒ—ã«å¼•ãç¶™ãã€‚

---

## Chart Plan JSON ã‚¹ã‚­ãƒ¼ãƒ v2

### å¤‰æ›´ç‚¹ï¼ˆv1ã‹ã‚‰ã®å·®åˆ†ï¼‰

- `schema_version` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆå°†æ¥äº’æ›æ€§ï¼‰
- `run_id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ï¼‰
- `columns` ã®ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚’ã€Œå·¥ç¨‹ãƒ•ã‚§ãƒ¼ã‚ºã€ã¨ã—ã¦å®šç¾©ï¼ˆæ—¥ä»˜é™å®šã§ã¯ãªã„ï¼‰

```json
{
  "schema_version": "1.0",
  "run_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "title": "æœˆæ¬¡å£²ä¸Šå ±å‘Šãƒ•ãƒ­ãƒ¼",
  "subtitle": "æœˆæ¬¡ï¼ˆæ¯æœˆæœ«ç· ã‚ã€ç¿Œæœˆ5å–¶æ¥­æ—¥ç›®å ±å‘Šï¼‰",
  "lanes": ["å„å–¶æ¥­æ‹ ç‚¹", "å–¶æ¥­ä¼ç”»éƒ¨", "çµŒç†éƒ¨", "çµŒå–¶ä¼ç”»éƒ¨", "çµŒå–¶ä¼ç”»éƒ¨é•·"],
  "columns": ["å£²ä¸Šç· ã‚", "é›†è¨ˆãƒ»ç¢ºèª", "å·®ç•°åˆ†æ", "ä¿®æ­£ãƒ»å†ç¢ºèª", "æ‰¿èª", "å ±å‘Š"],
  "layout": {
    "lane_height": 200,
    "col_width": 420,
    "left_label_width": 260,
    "header_height": 80,
    "frame_padding": 200,
    "task_w": 160,
    "task_h": 80,
    "decision_w": 110,
    "decision_h": 110,
    "chip_w": 130,
    "chip_h": 28
  },
  "nodes": [
    {
      "key": "START",
      "label": "é–‹å§‹",
      "lane": "å„å–¶æ¥­æ‹ ç‚¹",
      "col": 0,
      "kind": "start",
      "dx": -260,
      "dy": 0,
      "fill": "#BFE9D6"
    },
    {
      "key": "DEC_DIFF",
      "label": "å·®ç•°\nã‚ã‚‹ï¼Ÿ",
      "lane": "çµŒå–¶ä¼ç”»éƒ¨",
      "col": 2,
      "kind": "decision",
      "dx": 0,
      "dy": 0
    }
  ],
  "edges": [
    {"src": "START", "dst": "SF_INPUT"},
    {"src": "DEC_DIFF", "dst": "FIX", "label": "Yes", "color": "#2E7D32"},
    {"src": "FIX", "dst": "RECON", "dashed": true, "color": "#C62828", "shape": "curved"}
  ]
}
```

**columns ã®æ„å‘³:** ã€Œå·¥ç¨‹ãƒ•ã‚§ãƒ¼ã‚ºã€ã¨ã—ã¦å®šç¾©ã€‚æ—¥ä»˜ãƒ»æ™‚åˆ»ã¯å„ã‚«ãƒ©ãƒ ã®ãƒ©ãƒ™ãƒ«ã«å«ã‚ã¦ã‚ˆã„ãŒã€é€†æµã‚¨ãƒƒã‚¸ï¼ˆå·®æˆ»ã—ãƒ»ãƒ«ãƒ¼ãƒ—ï¼‰ã‚‚è‡ªç„¶ã«è¡¨ç¾å¯èƒ½ãªç²’åº¦ã¨ã™ã‚‹ã€‚

---

## Miro API é‹ç”¨ä»•æ§˜

### ãƒªãƒˆãƒ©ã‚¤ãƒ»ãƒ¬ãƒ¼ãƒˆåˆ¶é™

| é …ç›® | ä»•æ§˜ |
|---|---|
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | 100,000 credits/min, Level 1 = 50 credits/call |
| ãƒãƒ«ã‚¯ä¸Šé™ | 20 items/batch |
| ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ | æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ• (1s, 2s, 4s, 8s, æœ€å¤§16s) |
| æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•° | 3å›/ãƒªã‚¯ã‚¨ã‚¹ãƒˆ |
| 429å¿œç­”æ™‚ | Retry-Afterãƒ˜ãƒƒãƒ€ã‚’å°Šé‡ã€ãªã‘ã‚Œã°æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ• |
| éƒ¨åˆ†å¤±æ•— | ãƒãƒ«ã‚¯ä½œæˆã¯å…¨ä»¶or0ä»¶ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒŠãƒ«ï¼‰â†’ ãƒãƒƒãƒå˜ä½ã§ãƒªãƒˆãƒ©ã‚¤ |
| miro_items.json flush | ãƒãƒƒãƒæˆåŠŸã”ã¨ã«å³åº§æ›¸ãè¾¼ã¿ |

### ãƒœãƒ¼ãƒ‰é‹ç”¨ãƒ¢ãƒ¼ãƒ‰: å°‚ç”¨Frameæ–°è¦ç”Ÿæˆ

- æ—¢å­˜ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã¯ä¸€åˆ‡è§¦ã‚Œãªã„
- å„å®Ÿè¡Œ(run)ã§æ–°è¦Frameã‚’ä½œæˆã—ã€ãã®ä¸­ã«å…¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’é…ç½®
- Frameã®ä½ç½®: æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å³å´ã«è‡ªå‹•é…ç½®ï¼ˆæ—¢å­˜Frameæ¤œå‡ºâ†’å³ç«¯+ä½™ç™½ï¼‰
- å†å®Ÿè¡Œæ™‚: æ—§Frameã‚’å‰Šé™¤ã—ã¦æ–°Frameã‚’ä½œæˆï¼ˆcleanupçµŒç”±ï¼‰

### å‰Šé™¤ï¼ˆcleanupï¼‰ã®å®‰å…¨ç­–

1. miro_items.json ã® run_id + frame_id ã§å¯¾è±¡ã‚’ç‰¹å®š
2. **Frame å­˜åœ¨ãƒã‚§ãƒƒã‚¯**: Frame ãŒæ—¢ã«å‰Šé™¤æ¸ˆã¿ãªã‚‰å³å®Œäº†ï¼ˆå…¨ã‚¢ã‚¤ãƒ†ãƒ ã‚‚æ¶ˆå»æ¸ˆã¿ã¨åˆ¤æ–­ï¼‰
3. Frameå†…ã®ã‚¢ã‚¤ãƒ†ãƒ ã®ã¿å‰Šé™¤å¯¾è±¡
4. å‰Šé™¤å‰ã«ã‚¢ã‚¤ãƒ†ãƒ æ•°ã®ç…§åˆï¼ˆJSONã®ä»¶æ•° vs API readbackã®ä»¶æ•°ï¼‰
5. ä¸ä¸€è‡´æ™‚ã¯è­¦å‘Šã‚’å‡ºã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªã‚’æ±‚ã‚ã‚‹
6. å‰Šé™¤ã¯ã‚³ãƒã‚¯ã‚¿ â†’ ã‚·ã‚§ã‚¤ãƒ— â†’ ãƒ†ã‚­ã‚¹ãƒˆ â†’ Frame ã®é †åºï¼ˆä¾å­˜é–¢ä¿‚é †ï¼‰
7. **404 ã¯æ­£å¸¸æ‰±ã„**: å‰Šé™¤æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ ã¸ã® DELETE ã¯ 404 ã§å³ returnï¼ˆãƒªãƒˆãƒ©ã‚¤ã—ãªã„ï¼‰

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
swimlane-chart/
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ skills/
â”‚   â”‚   â”œâ”€â”€ process-analyzer/
â”‚   â”‚   â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”‚   â”‚   â””â”€â”€ references/
â”‚   â”‚   â”‚       â”œâ”€â”€ process_analysis_checklist.md
â”‚   â”‚   â”‚       â””â”€â”€ question_patterns.md
â”‚   â”‚   â”œâ”€â”€ requirements-reviewer/
â”‚   â”‚   â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”‚   â”‚   â””â”€â”€ references/
â”‚   â”‚   â”‚       â”œâ”€â”€ review_criteria.md
â”‚   â”‚   â”‚       â””â”€â”€ common_gaps.md
â”‚   â”‚   â”œâ”€â”€ chart-planner/
â”‚   â”‚   â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”‚   â”‚   â”œâ”€â”€ references/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout_heuristics.md
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ node_kind_guide.md
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ color_palette.md
â”‚   â”‚   â”‚   â””â”€â”€ assets/
â”‚   â”‚   â”‚       â””â”€â”€ chart_plan_schema.json
â”‚   â”‚   â”œâ”€â”€ chart-generator/
â”‚   â”‚   â”‚   â”œâ”€â”€ SKILL.md
â”‚   â”‚   â”‚   â””â”€â”€ references/
â”‚   â”‚   â”‚       â””â”€â”€ miro_api_constraints.md
â”‚   â”‚   â””â”€â”€ swimlane-pipeline/
â”‚   â”‚       â”œâ”€â”€ SKILL.md
â”‚   â”‚       â””â”€â”€ references/
â”‚   â”‚           â””â”€â”€ pipeline_workflow.md
â”‚   â””â”€â”€ agents/
â”‚       â”œâ”€â”€ process-consultant.md
â”‚       â”œâ”€â”€ chart-layout-reviewer.md
â”‚       â””â”€â”€ process-analyst.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ swimlane_lib.py            â† æ—¢å­˜ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯æŠ½å‡º
â”‚   â””â”€â”€ chart_plan_loader.py       â† JSONèª­è¾¼+ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ generate_chart.py          â† JSON â†’ Miro (Frameå†…ã€éšæ™‚flush)
â”‚   â”œâ”€â”€ cleanup_chart.py           â† run_idã‚¹ã‚³ãƒ¼ãƒ—å‰Šé™¤
â”‚   â””â”€â”€ validate_chart.py          â† run_idã‚¹ã‚³ãƒ¼ãƒ—èª­æˆ»ã—+æ¤œè¨¼
â”œâ”€â”€ output/                        â† .gitignoreå¯¾è±¡
â”‚   â””â”€â”€ {run_id}/                  â† runå˜ä½ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚       â”œâ”€â”€ requirements.md
â”‚       â”œâ”€â”€ chart_plan.json
â”‚       â”œâ”€â”€ miro_items.json
â”‚       â””â”€â”€ validation_report.json
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ monthly_report_flow.json   â† æ—¢å­˜ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã®JSONåŒ–
â”œâ”€â”€ scripts/swimlane_chart_demo.py  â† ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ pipeline-design.md
â”‚   â”œâ”€â”€ miro-chart-architecture.md
â”‚   â””â”€â”€ setup-guide.md
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â””â”€â”€ requirements.txt
```

---

## å„Skill è©³ç´°è¨­è¨ˆ

### Skill 1: process-analyzer

**å…¥åŠ›:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè²¼ã‚Šä»˜ã‘ãŸè­°äº‹éŒ²ãƒ»ãƒ¡ãƒ¢ãƒ»æ¥­å‹™ã‚·ãƒŠãƒªã‚ªãƒ†ã‚­ã‚¹ãƒˆ

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**

1. ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ã€ä»¥ä¸‹ã‚’æŠ½å‡º:
   - é–¢é€£éƒ¨é–€ãƒ»å½¹è·ï¼ˆã‚¹ã‚¤ãƒ ãƒ¬ãƒ¼ãƒ³å€™è£œï¼‰
   - æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹ã‚¹ãƒ†ãƒƒãƒ—ã¨ãã®æ™‚ç³»åˆ—
   - åˆ¤æ–­ãƒã‚¤ãƒ³ãƒˆï¼ˆåˆ†å²æ¡ä»¶ãƒ»Yes/Noå…ˆï¼‰
   - ä½¿ç”¨ã‚·ã‚¹ãƒ†ãƒ ãƒ»ãƒ„ãƒ¼ãƒ«
   - å„ã‚¹ãƒ†ãƒƒãƒ—ã®å…¥åŠ›/å‡ºåŠ›
   - ä¾‹å¤–ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¹
2. AskUserQuestion ã§ä¸æ˜ç‚¹ã‚’è³ªå•ï¼ˆçµ‚äº†æ¡ä»¶: 2ãƒ©ã‚¦ãƒ³ãƒ‰ã¾ãŸã¯ç´¯è¨ˆ15å•ï¼‰
3. æœªç¢ºèªäº‹é …ã¯ `(Assumption)` ã‚¿ã‚°ä»˜ãã§ã€Œå‰æãƒ»æœªç¢ºèªäº‹é …ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¨˜éŒ²
4. `output/{run_id}/requirements.md` ã‚’ç”Ÿæˆ

**å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:**

```markdown
# æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹è¦ä»¶å®šç¾©æ›¸: [ãƒ—ãƒ­ã‚»ã‚¹å]

## æ¦‚è¦
- ãƒ—ãƒ­ã‚»ã‚¹å / ç›®çš„ / é »åº¦ / ãƒˆãƒªã‚¬ãƒ¼

## é–¢é€£éƒ¨é–€ãƒ»å½¹è·ï¼ˆã‚¹ã‚¤ãƒ ãƒ¬ãƒ¼ãƒ³å€™è£œï¼‰
1. [éƒ¨é–€A] - [å½¹å‰²èª¬æ˜]

## ãƒ—ãƒ­ã‚»ã‚¹ã‚¹ãƒ†ãƒƒãƒ—
### Step N: [ã‚¹ãƒ†ãƒƒãƒ—å]
- **æ‹…å½“éƒ¨é–€**: ...
- **å·¥ç¨‹ãƒ•ã‚§ãƒ¼ã‚º**: ... (columnsã®å€™è£œ)
- **å‡¦ç†å†…å®¹**: ...
- **ä½¿ç”¨ã‚·ã‚¹ãƒ†ãƒ **: ...
- **å…¥åŠ›**: ... / **å‡ºåŠ›**: ...
- **åˆ¤æ–­ãƒã‚¤ãƒ³ãƒˆ**: [æ¡ä»¶] â†’ Yes: [å…ˆ] / No: [å…ˆ]

## åˆ¤æ–­ãƒ­ã‚¸ãƒƒã‚¯ä¸€è¦§
## ä¾‹å¤–ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¹
## å‰æãƒ»æœªç¢ºèªäº‹é …
- (Assumption) [æœªç¢ºèªã®å‰æäº‹é …...]
## ãƒ’ã‚¢ãƒªãƒ³ã‚°ã§ç¢ºèªæ¸ˆã¿ã®äº‹é …
```

### Skill 2: requirements-reviewer

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**

1. `output/{run_id}/requirements.md` ã‚’èª­ã¿è¾¼ã‚€
2. process-consultant ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é€ä»˜ã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä¾é ¼
3. ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’å—é ˜ï¼ˆCritical/Major/Minor/Infoï¼‰
4. ä¿®æ­£æ–¹é‡:
   - **Critical/Major:** å·®åˆ†ãƒ‘ãƒƒãƒã‚’ç”Ÿæˆ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤º â†’ æ‰¿èªå¾Œã«é©ç”¨
   - **Minor/Info:** è‡ªå‹•é©ç”¨ï¼ˆè¨˜è¼‰è¿½åŠ ãƒ»æ˜ç¢ºåŒ–ã®ã¿ã€‚äº‹å®Ÿã®æ›¸ãæ›ãˆã¯è¡Œã‚ãªã„ï¼‰
5. ä¿®æ­£å¾Œã€å†åº¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é€ä»˜ï¼ˆæœ€å¤§3ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
6. 3ãƒ©ã‚¦ãƒ³ãƒ‰å¾Œã«CriticalãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### Skill 3: chart-planner

**å…¥åŠ›:** `output/{run_id}/requirements.md`ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼æ¸ˆã¿ï¼‰

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**

1. éƒ¨é–€ä¸€è¦§ â†’ `lanes` é…åˆ—
2. **ãƒ¬ãƒ¼ãƒ³é †åºã®æœ€é©åŒ–**: éš£æ¥æ€§åŸå‰‡ï¼ˆæ¥ç¶šã®å¤šã„ãƒ¬ãƒ¼ãƒ³åŒå£«ã‚’éš£æ¥ï¼‰ã€åˆ†å²è¿‘æ¥åŸå‰‡ï¼ˆdecision ã®åˆ†å²å…ˆã‚’éš£æ¥ï¼‰ã€ç©ºãƒ¬ãƒ¼ãƒ³å›é¿
3. å·¥ç¨‹ãƒ•ã‚§ãƒ¼ã‚º â†’ `columns` é…åˆ— (æ—¥ä»˜é™å®šã§ã¯ãªããƒ•ã‚§ãƒ¼ã‚ºã¨ã—ã¦å®šç¾©)
4. **ã‚«ãƒ©ãƒ ã®çµ±åˆæ¤œè¨**: decision ã¨ç›´å‰ã‚¿ã‚¹ã‚¯ã®åŒä¸€ã‚«ãƒ©ãƒ é…ç½®ã€ç©ºã‚«ãƒ©ãƒ æ’é™¤ã€ç›®æ¨™ â‰¤7 ã‚«ãƒ©ãƒ 
5. å„ãƒ—ãƒ­ã‚»ã‚¹ã‚¹ãƒ†ãƒƒãƒ— â†’ `nodes` é…åˆ— (key, label, lane, col, kind)
6. åŒä¸€ã‚»ãƒ«å†…ã®è¤‡æ•°ãƒãƒ¼ãƒ‰ â†’ dx/dy ã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®—ï¼ˆlayout_heuristics.md ã«å¾“ã†ã€2ãƒãƒ¼ãƒ‰ã¯ Â±100ã€3ãƒãƒ¼ãƒ‰ã¯ -160/0/+160ï¼‰
7. ãƒ—ãƒ­ã‚»ã‚¹é–“ã®æ¥ç¶š â†’ `edges` é…åˆ—ï¼ˆé€†æµã‚¨ãƒƒã‚¸ã‚‚å«ã‚€ï¼‰
8. ã‚·ã‚¹ãƒ†ãƒ ãƒ©ãƒ™ãƒ« â†’ chip ãƒãƒ¼ãƒ‰
9. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è‡ªå‹•èª¿æ•´ï¼ˆãƒ¬ãƒ¼ãƒ³æ•°ãƒ»ã‚«ãƒ©ãƒ æ•°ã«å¿œã˜ã¦ã‚µã‚¤ã‚ºè¨ˆç®—ï¼‰
10. `schema_version` ã¨ `run_id` ã‚’ã‚»ãƒƒãƒˆ
11. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: å…¨edgeã®src/dstãŒå­˜åœ¨ã™ã‚‹ã‹ã€å…¨nodeã®laneãŒlanesã«å­˜åœ¨ã™ã‚‹ã‹ã€decision ã®åˆ†å²å…ˆãƒ¬ãƒ¼ãƒ³ãŒéš£æ¥ã—ã¦ã„ã‚‹ã‹ã€ã‚«ãƒ©ãƒ æ•° â‰¤7 ã‹

**å‡ºåŠ›:** `output/{run_id}/chart_plan.json`

### Skill 4: chart-generator

**å…¥åŠ›:** `output/{run_id}/chart_plan.json`

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**

1. `scripts/generate_chart.py` ã‚’å®Ÿè¡Œ
2. `chart_plan.json` ã‚’èª­ã¿è¾¼ã¿ â†’ Node/Edge/Layout dataclassã«å¤‰æ›
3. å°‚ç”¨Frameã‚’ä½œæˆï¼ˆæ—¢å­˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å³å´ã«é…ç½®ï¼‰
4. Frameå†…ã«å…¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒãƒ«ã‚¯ä½œæˆï¼ˆ20ä»¶/ãƒãƒƒãƒã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ä»˜ããƒªãƒˆãƒ©ã‚¤ï¼‰
5. ãƒãƒƒãƒæˆåŠŸã”ã¨ã« `output/{run_id}/miro_items.json` ã¸flush
6. ã‚³ãƒã‚¯ã‚¿ã‚’ä½œæˆï¼ˆ1ä»¶ãšã¤ã€IDãƒãƒƒãƒ”ãƒ³ã‚°ä½¿ç”¨ï¼‰
7. ã‚¨ãƒ©ãƒ¼æ™‚ã¯ `scripts/cleanup_chart.py` ã§run_idã‚¹ã‚³ãƒ¼ãƒ—å†…ã‚’å‰Šé™¤ã—ã¦ãƒªãƒˆãƒ©ã‚¤

### Skill 5: swimlane-pipeline (ãƒã‚¹ã‚¿ãƒ¼ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼)

`/swimlane-pipeline` ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã€‚run_idã‚’ç”Ÿæˆã—ã€å…¨ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †æ¬¡å®Ÿè¡Œã€‚

**Step 5 (ãƒ¬ãƒ“ãƒ¥ãƒ¼) ã®å…·ä½“çš„å‡¦ç† (pipelineå†…ã§ç›´æ¥å®Ÿè¡Œ):**

1. `scripts/validate_chart.py` ã‚’å®Ÿè¡Œã—ã¦Miro APIèª­æˆ»ã— + ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯æ¤œè¨¼
2. æ¤œè¨¼çµæœã¨ `chart_plan.json` ã‚’ chart-layout-reviewer agent ã«é€ä»˜
3. agent ãŒ JSON Patchå½¢å¼ã§ä¿®æ­£æŒ‡ç¤ºã‚’è¿”å´
4. ä¿®æ­£ã‚ã‚Š â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤º â†’ æ‰¿èªå¾Œã«ãƒ‘ãƒƒãƒé©ç”¨ â†’ cleanup â†’ Step 3ã‹ã‚‰å†å®Ÿè¡Œ
5. æœ€å¤§3ãƒ©ã‚¦ãƒ³ãƒ‰ã€‚3ãƒ©ã‚¦ãƒ³ãƒ‰å¾Œã«å•é¡Œæ®‹å­˜ â†’ ç¾çŠ¶ã®ã¾ã¾çµæœæç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¤æ–­ï¼‰

---

## Agent è©³ç´°è¨­è¨ˆ

### Agent: process-consultant

```yaml
name: process-consultant
description: æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹è¦ä»¶å®šç¾©æ›¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚æŠœã‘æ¼ã‚Œãƒ»çŸ›ç›¾ãƒ»ã‚¹ã‚¤ãƒ ãƒ¬ãƒ¼ãƒ³ãƒãƒ£ãƒ¼ãƒˆåŒ–å¯å¦ã‚’åˆ¤å®šã€‚
model: sonnet
```

- **ãƒšãƒ«ã‚½ãƒŠ:** æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹æ”¹å–„15å¹´ã®ã‚·ãƒ‹ã‚¢ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ
- **åˆ¤æ–­åŸºæº–:** ã€Œã“ã®è¦ä»¶å®šç¾©æ›¸ã ã‘ã§ã€è¿·ã„ãªãã‚¹ã‚¤ãƒ ãƒ¬ãƒ¼ãƒ³ãƒãƒ£ãƒ¼ãƒˆã‚’æã‘ã‚‹ã‹ï¼Ÿã€
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹:**
  1. å…¨ã¦ã®é–¢é€£éƒ¨é–€ãŒç‰¹å®šã•ã‚Œã¦ã„ã‚‹ã‹
  2. éƒ¨é–€é–“ã®ãƒãƒ³ãƒ‰ã‚ªãƒ•ãŒæ˜ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹
  3. å…¨åˆ¤æ–­ãƒã‚¤ãƒ³ãƒˆã®ä¸¡åˆ†å²ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‹
  4. å·¥ç¨‹ãƒ•ã‚§ãƒ¼ã‚ºãŒã‚«ãƒ©ãƒ å‰²å½“å¯èƒ½ãªç²’åº¦ã‹
  5. ä½¿ç”¨ã‚·ã‚¹ãƒ†ãƒ ãƒ»ãƒ„ãƒ¼ãƒ«ãŒç‰¹å®šã•ã‚Œã¦ã„ã‚‹ã‹
  6. ä¾‹å¤–ãƒ‘ã‚¹ãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹
  7. `(Assumption)` ã‚¿ã‚°ä»˜ãã®å‰æã«æ˜ã‚‰ã‹ãªèª¤ã‚ŠãŒãªã„ã‹
- **å‡ºåŠ›:** æŒ‡æ‘˜äº‹é …ãƒªã‚¹ãƒˆ (Critical / Major / Minor / Info) + ä¿®æ­£å·®åˆ†ãƒ‘ãƒƒãƒ

### Agent: chart-layout-reviewer

```yaml
name: chart-layout-reviewer
description: ã‚¹ã‚¤ãƒ ãƒ¬ãƒ¼ãƒ³ãƒãƒ£ãƒ¼ãƒˆã®è¦–è¦šå“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚Miro APIèª­æˆ»ã—ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãJSON Patchå½¢å¼ã§ä¿®æ­£æŒ‡ç¤ºã‚’å‡ºåŠ›ã€‚
model: sonnet
```

- **ãƒšãƒ«ã‚½ãƒŠ:** æƒ…å ±ãƒ‡ã‚¶ã‚¤ãƒ³ã®å°‚é–€å®¶
- **å…¥åŠ›:** `chart_plan.json` + `validate_chart.py` ã®æ¤œè¨¼çµæœ
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹:**
  1. ãƒãƒ¼ãƒ‰é–“ã®é‡ãªã‚Šï¼ˆãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹äº¤å·®ï¼‰
  2. ã‚³ãƒã‚¯ã‚¿ã®æ¬ è½ãƒ»æ–­çµ¶
  3. ã‚³ãƒã‚¯ã‚¿ã®äº¤å·®ï¼ˆãƒ¬ãƒ¼ãƒ³ä¸¦ã³æ›¿ãˆã§è§£æ¶ˆå¯èƒ½ã‹ï¼‰
  4. ãƒ©ãƒ™ãƒ«ã®åˆ‡ã‚Œï¼ˆãƒ†ã‚­ã‚¹ãƒˆé•· vs ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã€‚æ—¥æœ¬èªã¯~16px/æ–‡å­—ã§æ¦‚ç®—ï¼‰
  5. ãƒ¬ãƒ¼ãƒ³é–“ã®ãƒãƒ©ãƒ³ã‚¹ï¼ˆç©ºãƒ¬ãƒ¼ãƒ³ã€éå¯†ãƒ¬ãƒ¼ãƒ³ï¼‰
  6. ã‚«ãƒ©ãƒ ä½¿ç”¨åŠ¹ç‡ï¼ˆç©ºã‚«ãƒ©ãƒ ã®æ’é™¤ã€çµ±åˆå¯èƒ½ãªã‚«ãƒ©ãƒ ï¼‰
  7. è‰²ã®ä¸€è²«æ€§
  8. åˆ¤æ–­ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã®ãƒ©ãƒ™ãƒ«åã¾ã‚Šï¼ˆ110Ã—110 ã§æœ‰åŠ¹è¡¨ç¤ºå¹… ~70pxï¼‰
  9. é€†æµã‚¨ãƒƒã‚¸ã®è¦–èªæ€§
  10. end ãƒãƒ¼ãƒ‰ã®é…ç½®ï¼ˆæœ€çµ‚ãƒ•ãƒ­ãƒ¼ã®åˆ°é”ãƒ¬ãƒ¼ãƒ³ãƒ»ã‚«ãƒ©ãƒ ã«é…ç½®ï¼‰
- **ä¿®æ­£ãƒ‘ãƒƒãƒå¯¾å¿œãƒ‘ã‚¹:** `/nodes/{index}/dx`, `/nodes/{index}/dy`, `/nodes/{index}/lane`, `/nodes/{index}/col`, `/lanes`, `/columns`, `/layout/col_width`, `/layout/task_w`, `/layout/decision_w`, `/layout/decision_h`, `/layout/chip_w`
- **å‡ºåŠ›:** JSON Patchå½¢å¼ã®ä¿®æ­£æŒ‡ç¤º

```json
{
  "review_round": 1,
  "findings": [
    {
      "severity": "Major",
      "description": "SF_INPUTã¨SLACK_DONEãŒé‡ãªã£ã¦ã„ã‚‹",
      "patch": [
        {"op": "replace", "path": "/nodes/1/dx", "value": 80}
      ]
    }
  ],
  "summary": "2ä»¶ã®Major, 1ä»¶ã®Minor"
}
```

### Agent: process-analyst

```yaml
name: process-analyst
description: éæ§‹é€ ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹è¦ç´ ã‚’æŠ½å‡ºã™ã‚‹å°‚é–€å®¶ã€‚
model: opus
```

- **ãƒšãƒ«ã‚½ãƒŠ:** æ¥­å‹™ãƒ—ãƒ­ã‚»ã‚¹åˆ†æã®å°‚é–€å®¶
- **ç”¨é€”:** process-analyzer skill å†…ã§ã€ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ—ãƒ­ã‚»ã‚¹è¦ç´ ã‚’æŠ½å‡ºã™ã‚‹éš›ã«ä½¿ç”¨

---

## ã‚³ãƒ¼ãƒ‰å¤‰æ›´è¨ˆç”»

### 1. swimlane_chart.py ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° â†’ src/swimlane_lib.py

**æŠ½å‡ºå¯¾è±¡ (swimlane_chart.py ã®ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ):**

- `Node`, `Edge`, `Layout` dataclass å®šç¾©
- `MiroClient` ã‚¯ãƒ©ã‚¹ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ãƒªãƒˆãƒ©ã‚¤è¿½åŠ ï¼‰
- `lane_center_y()`, `col_center_x()`, `node_xy()` åº§æ¨™è¨ˆç®—é–¢æ•°
- `shape_payload()`, `text_payload()`, `connector_payload()` ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°
- èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹ç¯‰é–¢æ•°ç¾¤ï¼ˆFrameä½œæˆæ©Ÿèƒ½è¿½åŠ ï¼‰

**æ–°è¦è¿½åŠ æ©Ÿèƒ½:**

- `create_frame(client, title, x, y, w, h)` â†’ Frameä½œæˆ
- `find_rightmost_frame(client)` â†’ æ—¢å­˜Frameã®å³ç«¯åº§æ¨™å–å¾—
- `cleanup_by_run(client, miro_items_path)` â†’ run_idã‚¹ã‚³ãƒ¼ãƒ—å‰Šé™¤
- `readback_frame_items(client, frame_id)` â†’ Frameå†…ã‚¢ã‚¤ãƒ†ãƒ èª­æˆ»ã—
- æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ä»˜ããƒªãƒˆãƒ©ã‚¤ (`@retry(max=3, backoff=[1,2,4])`)

### 2. src/chart_plan_loader.py (æ–°è¦)

- `load_chart_plan(json_path)` -> `ChartPlan` (NamedTuple)
- `schema_version` äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
- JSON Schema ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- Node/Edge/Layout dataclass ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
- `apply_patch(chart_plan_path, patches)` â†’ JSON Patchã®é©ç”¨

### 3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | CLI | èª¬æ˜ |
|---|---|---|
| scripts/generate_chart.py | `python scripts/generate_chart.py output/{run_id}/chart_plan.json` | JSON â†’ Miro (Frameå†…ã€éšæ™‚flush) |
| scripts/cleanup_chart.py | `python scripts/cleanup_chart.py output/{run_id}/miro_items.json` | run_idã‚¹ã‚³ãƒ¼ãƒ—å‰Šé™¤ |
| scripts/validate_chart.py | `python scripts/validate_chart.py output/{run_id}/miro_items.json` | èª­æˆ»ã—+é‡ãªã‚Šæ¤œå‡º+æ¥ç¶šæ¤œè¨¼ |

### 4. swimlane_chart.py (å…ƒãƒ•ã‚¡ã‚¤ãƒ«)

- `from src.swimlane_lib import *` ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤‰æ›´
- ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã¯ãã®ã¾ã¾ç¶­æŒï¼ˆå¾Œæ–¹äº’æ›ï¼‰
- å‹•ä½œã¯ä¸€åˆ‡å¤‰ã‚ã‚‰ãªã„

---

## å®Ÿè£…é †åº

### Phase 1: åŸºç›¤æ•´å‚™ (ã‚³ãƒ¼ãƒ‰ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°) âœ… å®Œäº†

1. `src/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆã€`swimlane_lib.py` ã«å…±é€šãƒ­ã‚¸ãƒƒã‚¯æŠ½å‡º
2. `src/chart_plan_loader.py` ä½œæˆ (JSON â†’ dataclasså¤‰æ› + ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³)
3. `scripts/generate_chart.py` ä½œæˆ (Frameç”Ÿæˆã€éšæ™‚flushå¯¾å¿œ)
4. `examples/monthly_report_flow.json` ä½œæˆï¼ˆæ—¢å­˜ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®JSONåŒ–ã€schema_versionä»˜ãï¼‰
5. `swimlane_chart.py` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹å¼ã«å¤‰æ›´
6. æ¤œè¨¼: JSONã‹ã‚‰ã®ç”ŸæˆãŒå…ƒã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨åŒä¸€çµæœã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª

### Phase 2: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ âœ… å®Œäº†

7. `scripts/cleanup_chart.py` ä½œæˆï¼ˆrun_idã‚¹ã‚³ãƒ¼ãƒ—ã€å‰Šé™¤é †åºåˆ¶å¾¡ã€404æ­£å¸¸æ‰±ã„ï¼‰
8. `scripts/validate_chart.py` ä½œæˆï¼ˆé‡ãªã‚Šæ¤œå‡ºã€æ¥ç¶šæ¤œè¨¼ã€ãƒ©ãƒ™ãƒ«åˆ‡ã‚Œæ¤œå‡ºï¼‰
9. æ¤œè¨¼: ç”Ÿæˆ â†’ èª­æˆ»ã— â†’ æ¤œè¨¼ â†’ å‰Šé™¤ã®ã‚µã‚¤ã‚¯ãƒ«å‹•ä½œç¢ºèª

### Phase 3: Agentå®šç¾©ä½œæˆ âœ… å®Œäº†

10. `.claude/agents/process-consultant.md`
11. `.claude/agents/chart-layout-reviewer.md` (JSON Patchå‡ºåŠ›å½¢å¼ã€ã‚³ãƒã‚¯ã‚¿äº¤å·®ãƒ»ã‚«ãƒ©ãƒ åŠ¹ç‡ãƒ»endãƒãƒ¼ãƒ‰é…ç½®ãƒ¬ãƒ“ãƒ¥ãƒ¼)
12. `.claude/agents/process-analyst.md`

### Phase 4: Skillä½œæˆï¼ˆä¸‹æµ â†’ ä¸Šæµã®é †ï¼‰ âœ… å®Œäº†

13. chart-generator skill + references (miro_api_constraints.md: Frameå†…åº§æ¨™ãƒ»parentæ³¨å…¥)
14. chart-planner skill + references (layout_heuristics.md: ãƒ¬ãƒ¼ãƒ³é †åºæœ€é©åŒ–ãƒ»ã‚«ãƒ©ãƒ çµ±åˆ, node_kind_guide.md: æ›´æ–°æ¸ˆã¿ã‚µã‚¤ã‚º, color_palette.md) + schema
15. requirements-reviewer skill + references (review_criteria.md, common_gaps.md)
16. process-analyzer skill + references (process_analysis_checklist.md, question_patterns.md)

### Phase 5: ãƒã‚¹ã‚¿ãƒ¼ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ + çµ±åˆãƒ†ã‚¹ãƒˆ âœ… å®Œäº†

17. swimlane-pipeline skill ä½œæˆ (Step 5ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ«ãƒ¼ãƒ—å«ã‚€)
18. E2Eãƒ†ã‚¹ãƒˆ: ã‚¤ãƒ³ãƒœã‚¤ã‚¹è‡ªå‹•å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆ7ãƒ¬ãƒ¼ãƒ³ãƒ»7ã‚«ãƒ©ãƒ ãƒ»23ãƒãƒ¼ãƒ‰ãƒ»23ã‚³ãƒã‚¯ã‚¿ãƒ»3åˆ†å²åˆ¤å®šï¼‰ã§å…¨ã‚¹ãƒ†ãƒƒãƒ—é€šã—ãƒ†ã‚¹ãƒˆå®Œäº†

---

## æ¤œè¨¼æ–¹æ³•

### Phase 1 æ¤œè¨¼

```bash
# ãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
python scripts/swimlane_chart_demo.py
# JSONç‰ˆã§åŒä¸€çµæœ
python scripts/generate_chart.py examples/monthly_report_flow.json
```

### Phase 2 æ¤œè¨¼

```bash
python scripts/validate_chart.py output/{run_id}/miro_items.json
python scripts/cleanup_chart.py output/{run_id}/miro_items.json
```

### Phase 5 æ¤œè¨¼

```bash
# å€‹åˆ¥Skillå‹•ä½œç¢ºèª
/process-analyzer    â† ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› â†’ requirements.md ç”Ÿæˆç¢ºèª
/requirements-reviewer â† ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ«ãƒ¼ãƒ—å‹•ä½œç¢ºèª
/chart-planner       â† requirements.md â†’ chart_plan.json ç¢ºèª
/chart-generator     â† chart_plan.json â†’ Miroãƒãƒ£ãƒ¼ãƒˆç¢ºèª

# çµ±åˆãƒ†ã‚¹ãƒˆ
/swimlane-pipeline   â† å…¨å·¥ç¨‹ä¸€æ°—é€šè²«ãƒ†ã‚¹ãƒˆ
```

---

## ä¸»è¦ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

| ãƒªã‚¹ã‚¯ | å¯¾ç­– |
|---|---|
| dx/dyè¨ˆç®—ã®ç²¾åº¦ | layout_heuristics.mdã«ãƒ«ãƒ¼ãƒ«ã‚’è©³ç´°ã«è¨˜è¼‰ã€‚åŒä¸€ã‚»ãƒ«å†…2ãƒãƒ¼ãƒ‰ã¯dxÂ±100ã€3ãƒãƒ¼ãƒ‰ã¯-160/0/+160 |
| æ—¥æœ¬èªãƒ©ãƒ™ãƒ«å¹…ã®è¦‹ç©ã‚Š | ~16px/æ–‡å­—ã§æ¦‚ç®—ã€‚decision(110Ã—110)ã¯æœ‰åŠ¹å¹…~70px=4æ–‡å­—/è¡Œã€‚validate_chart.pyã§åˆ‡ã‚Œæ¤œå‡º |
| ã‚³ãƒã‚¯ã‚¿äº¤å·® | ãƒ¬ãƒ¼ãƒ³é †åºæœ€é©åŒ–ï¼ˆéš£æ¥æ€§åŸå‰‡ãƒ»åˆ†å²è¿‘æ¥åŸå‰‡ï¼‰ã§äº¤å·®ã‚’æœ€å°åŒ– |
| Miro APIãƒãƒ«ã‚¯å‰Šé™¤ãªã— | ã‚³ãƒã‚¯ã‚¿â†’ã‚·ã‚§ã‚¤ãƒ—â†’ãƒ†ã‚­ã‚¹ãƒˆâ†’Frameé †ã®é€æ¬¡å‰Šé™¤ï¼ˆä¸‹è¨˜ã€Œå‰Šé™¤é †åºã€å‚ç…§ï¼‰ã€‚404ã¯æ­£å¸¸æ‰±ã„ï¼ˆæ—¢å‰Šé™¤ï¼‰ã§å³return |
| cleanupæ™‚ã®ãƒãƒ³ã‚° | Frameå­˜åœ¨ãƒã‚§ãƒƒã‚¯ã§æ—©æœŸçµ‚äº†ã€‚delete_item/delete_connectorã«404ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ  |
| ã‚³ãƒã‚¯ã‚¿çµŒè·¯ã®åˆ¶å¾¡ä¸èƒ½ | 3ãƒ¬ãƒ¼ãƒ³ä»¥ä¸Šè·¨ãã‚¨ãƒƒã‚¸ã¯é€æ˜ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ä¸­ç¶™ã‚’æ¤œè¨ |
| Frameå†…åº§æ¨™ç³» | å…¨ã‚¢ã‚¤ãƒ†ãƒ ã«parentãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§Frame IDã‚’æ³¨å…¥ã€‚Miro APIã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåº§æ¨™ç³»ï¼ˆFrameä¸­å¿ƒåŸç‚¹ï¼‰ã§é…ç½® |
| ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä¸­æ–­æ™‚ã®å›å¾© | miro_items.jsonéšæ™‚flush + run_idã‚¹ã‚³ãƒ¼ãƒ—ã§cleanupå¯èƒ½ |
| LLMã«ã‚ˆã‚‹äº‹å®Ÿæ›¸æ›ãƒªã‚¹ã‚¯ | Critical/Majorä¿®æ­£ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªå¿…é ˆã€‚è‡ªå‹•é©ç”¨ã¯Minor/Infoã®è¿½è¨˜ã®ã¿ |
| **Miro API SPOF** | ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ãŒMiro REST API v2ã«ä¾å­˜ã€‚APIéšœå®³æ™‚ã¯ãƒªãƒˆãƒ©ã‚¤ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•æœ€å¤§3å›ï¼‰ã§è‡ªå‹•å›å¾©ã‚’è©¦ã¿ã‚‹ãŒã€é•·æ™‚é–“éšœå®³æ™‚ã¯ä¸­é–“æˆæœç‰©ï¼ˆchart_plan.jsonï¼‰ã‚’ä¿æŒã—ã€å¾©æ—§å¾Œã« Step 4 ã‹ã‚‰å†å®Ÿè¡Œå¯èƒ½ã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä»£æ›¿æ‰‹æ®µãªã— |

### å‰Šé™¤é †åºã®æŠ€è¡“çš„æ ¹æ‹ 

cleanup æ™‚ã®å‰Šé™¤ã¯ä»¥ä¸‹ã®é †åºã§å®Ÿè¡Œã™ã‚‹:

1. **ã‚³ãƒã‚¯ã‚¿** â†’ 2. **ã‚·ã‚§ã‚¤ãƒ—/ãƒ†ã‚­ã‚¹ãƒˆ** â†’ 3. **Frame**

ã“ã®é †åºã®ç†ç”±:
- **ã‚³ãƒã‚¯ã‚¿ã¯ startItem/endItem ã¸ã®å‚ç…§ã‚’ä¿æŒ**ã—ã¦ã„ã‚‹ãŸã‚ã€å…ˆã«ã‚·ã‚§ã‚¤ãƒ—ã‚’å‰Šé™¤ã™ã‚‹ã¨ã‚³ãƒã‚¯ã‚¿ãŒå­¤ç«‹å‚ç…§ã‚’æŒã¤çŠ¶æ…‹ã«ãªã‚‹ã€‚Miro API ã¯ã“ã®çŠ¶æ…‹ã§ã‚‚ 200 ã‚’è¿”ã™ãŒã€ä¸€éƒ¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ“ä½œã§ä¸æ•´åˆãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- **Frame ã‚’å‰Šé™¤ã™ã‚‹ã¨å†…éƒ¨ã‚¢ã‚¤ãƒ†ãƒ ã‚‚é€£é–å‰Šé™¤ã•ã‚Œã‚‹**ãŒã€ã‚³ãƒã‚¯ã‚¿ã¯ Frame å¤–ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã‚ã‚‹ãŸã‚æ®‹å­˜ã™ã‚‹ã€‚Frame ã‚’å…ˆã«å‰Šé™¤ã™ã‚‹ã¨ã€ã‚³ãƒã‚¯ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã«å¿…è¦ãªæƒ…å ±ï¼ˆã©ã®ã‚³ãƒã‚¯ã‚¿ãŒã“ã® run ã«å±ã™ã‚‹ã‹ï¼‰ã®ç‰¹å®šãŒã‚³ãƒã‚¯ã‚¿ä¸€è¦§ã®å…¨ä»¶èµ°æŸ»ã«ä¾å­˜ã—ã¦ã—ã¾ã†
- ã‚³ãƒã‚¯ã‚¿ã‚’å…ˆã«å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€å‚ç…§æ•´åˆæ€§ã‚’ä¿ã¡ã¤ã¤ã€å„ã‚¢ã‚¤ãƒ†ãƒ ã®å‰Šé™¤ãŒç‹¬ç«‹ã—ã¦å®‰å…¨ã«è¡Œãˆã‚‹
