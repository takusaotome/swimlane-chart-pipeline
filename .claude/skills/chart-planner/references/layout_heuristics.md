# Layout Heuristics

## 基本レイアウトパラメータ

| パラメータ | デフォルト値 | 自動調整ルール |
|---|---|---|
| lane_height | 220 | レーン内ノード数 > 2 の場合: 220 + (ノード数 - 2) × 60 |
| col_width | 360 | カラム内ノード数 > 2 の場合: 360 + (ノード数 - 2) × 100 |
| left_label_width | 240 | 最長部門名(日本語) × 16px + 40px (padding), 最小240 |
| header_height | 80 | 固定 |
| frame_padding | 200 | 固定 |
| task_w | 170 | ラベル幅が超える場合は拡大 |
| task_h | 80 | 固定 |
| decision_w | 90 | 固定 |
| decision_h | 90 | 固定 |
| chip_w | 90 | ラベル幅が超える場合は拡大 |
| chip_h | 26 | 固定 |

## 同一セル内の複数ノード配置

同一セル（同一 lane × 同一 col）に複数のフローノード（task/decision/start/end）がある場合:

### 2ノードの場合
```
Node A: dx = -90, dy = 0
Node B: dx = +90, dy = 0
```

### 3ノードの場合
```
Node A: dx = -180, dy = 0
Node B: dx = 0, dy = 0
Node C: dx = +180, dy = 0
```

### 一般規則
- N個のノードを水平方向に等間隔配置
- 間隔: 180px（task_w + 10px マージン）
- 中央を基点に左右対称配置

## chip ノードの配置

chip ノードは対応する親ノード（task/decision）の直下に配置:
- dx: 親ノードと同じ dx
- dy: 親ノードの dy + 70

## start/end ノードの配置

- start ノード: 最初のカラム (col=0) の左端に配置、dx=-230
- end ノード: 最後のカラムの右端に配置、dx=+260

## レーン数に応じた調整

| レーン数 | lane_height | 補足 |
|---|---|---|
| 1-5 | 220 (デフォルト) | |
| 6-10 | 200 | コンパクト化 |
| 11-15 | 180 | さらにコンパクト化 |

## カラム数に応じた調整

| カラム数 | col_width | 補足 |
|---|---|---|
| 1-7 | 360 (デフォルト) | |
| 8-12 | 320 | コンパクト化 |
| 13-20 | 280 | さらにコンパクト化 |

## 逆流エッジ（差戻し・ループ）の扱い

逆流エッジがある場合:
- shape: "curved" を指定して視覚的に区別
- dashed: true で点線表示
- 逆流先のノードに十分な空間があることを確認
- 必要に応じて lane_height を拡大
